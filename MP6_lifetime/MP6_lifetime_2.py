import tool.NBTI_formula as NBTI 
import tool.vth_body_map as VTH
from map_pb_to_current import get_current_from_pb, get_pb_from_current
import sys
import ast

from tool.log import Log
log = Log(name="terminal-log.txt", terminal=True)
log.println()

"""
SCRIPT (for 8bit):
for lay in range(7):
    for fa_index in range(8):
        for t_index in range(6):
            os.system(f"python MP6_lifetime_2.py \"{{'lay':{lay}, 'fa_index':{fa_index}, 't_index':{t_index}}}\"")
"""
# FAULTY_TRANSISTOR = ast.literal_eval(sys.argv[1])
FAULTY_TRANSISTOR = False or {'lay': 2, 'fa_index': 3, 't_index': 0}
FAULTY_VTH_BASE = 1.1
FAULTY_VTH_GROWTH_RATE = 1.1
log.println(f"Fault: {FAULTY_TRANSISTOR}, basex{FAULTY_VTH_BASE}, growthx{FAULTY_VTH_GROWTH_RATE}")

"""
NOTE: regular 8bit multiplier, file1 optimizer
        ######################### OPTIMIZER
        if OPTIMIZER_ENABLE:
            if (A == -1*2**(bit_len-1)) or (B == -1*2**(bit_len-1)):
                pass
            else:
                if (mp.gfa[1][7].tgate[0].p1.gate == L):
                    neg_A = -A
                    neg_B = -B
                    neg_mp = MPn_v3(
                        signed_b(neg_A, bit_len),
                        signed_b(neg_B, bit_len),
                        bit_len
                    )
                    neg_mp.output

                    if (neg_mp.gfa[1][7].tgate[0].p1.gate == H) or (neg_mp.gfa[0][5].tgate[0].p0.gate == H):
                        mp = neg_mp
                        optimized_flag = True
                        # log.println(f"{A} * {B}, [optimizer: {optimized_flag}]")

        ######################### /OPTIMIZER
"""


bit_len = 8
normal_alpha = \
    [
        [[0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.25, 0.75, 0.375, 0.625, 0.625, 0.375], [0.0, 0.5, 0.75, 0.25, 0.25, 0.75]], 
        [[0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.375, 0.625, 0.4375, 0.5625, 0.5625, 0.4375], [0.7080078125, 0.2919921875, 0.6044921875, 0.3955078125, 0.3955078125, 0.6044921875], [0.146484375, 0.853515625, 0.75, 0.25, 0.25, 0.75]], 
        [[0.5625, 0.4375, 0.53125, 0.46875, 0.46875, 0.53125], [0.5625, 0.4375, 0.53125, 0.46875, 0.46875, 0.53125], [0.5625, 0.4375, 0.53125, 0.46875, 0.46875, 0.53125], [0.5625, 0.4375, 0.53125, 0.46875, 0.46875, 0.53125], [0.4375, 0.5625, 0.46875, 0.53125, 0.53125, 0.46875], [0.6083984375, 0.3916015625, 0.5546875, 0.4453125, 0.4453125, 0.5546875], [0.64501953125, 0.35498046875, 0.5869140625, 0.4130859375, 0.4130859375, 0.5869140625], [0.2763671875, 0.7236328125, 0.75, 0.25, 0.25, 0.75]], 
        [[0.53125, 0.46875, 0.515625, 0.484375, 0.484375, 0.515625], [0.53125, 0.46875, 0.515625, 0.484375, 0.484375, 0.515625], [0.53125, 0.46875, 0.515625, 0.484375, 0.484375, 0.515625], [0.46875, 0.53125, 0.484375, 0.515625, 0.515625, 0.484375], [0.5556640625, 0.4443359375, 0.5283203125, 0.4716796875, 0.4716796875, 0.5283203125], [0.5751953125, 0.4248046875, 0.547607421875, 0.452392578125, 0.452392578125, 0.547607421875], [0.59326171875, 0.40673828125, 0.580810546875, 0.419189453125, 0.419189453125, 0.580810546875], [0.366455078125, 0.633544921875, 0.75, 0.25, 0.25, 0.75]], 
        [[0.515625, 0.484375, 0.5078125, 0.4921875, 0.4921875, 0.5078125], [0.515625, 0.484375, 0.5078125, 0.4921875, 0.4921875, 0.5078125], [0.484375, 0.515625, 0.4921875, 0.5078125, 0.5078125, 0.4921875], [0.52783203125, 0.47216796875, 0.514404296875, 0.485595703125, 0.485595703125, 0.514404296875], [0.539306640625, 0.460693359375, 0.5242919921875, 0.4757080078125, 0.4757080078125, 0.5242919921875], [0.5478515625, 0.4521484375, 0.543212890625, 0.456787109375, 0.456787109375, 0.543212890625], [0.5574951171875, 0.4425048828125, 0.5789794921875, 0.4210205078125, 0.4210205078125, 0.5789794921875], [0.4229736328125, 0.5770263671875, 0.75, 0.25, 0.25, 0.75]], 
        [[0.5078125, 0.4921875, 0.50390625, 0.49609375, 0.49609375, 0.50390625], [0.4921875, 0.5078125, 0.49609375, 0.50390625, 0.50390625, 0.49609375], [0.51513671875, 0.48486328125, 0.508056640625, 0.491943359375, 0.491943359375, 0.508056640625], [0.520751953125, 0.479248046875, 0.5130615234375, 0.4869384765625, 0.4869384765625, 0.5130615234375], [0.5244140625, 0.4755859375, 0.5225830078125, 0.4774169921875, 0.4774169921875, 0.5225830078125], [0.5294189453125, 0.4705810546875, 0.54254150390625, 0.45745849609375, 0.45745849609375, 0.54254150390625], [0.5341796875, 0.4658203125, 0.5780029296875, 0.4219970703125, 0.4219970703125, 0.5780029296875], [0.45684814453125, 0.54315185546875, 0.75, 0.25, 0.25, 0.75]], 
        [[0.49609375, 0.50390625, 0.501953125, 0.498046875, 0.498046875, 0.501953125], [0.5059814453125, 0.4940185546875, 0.49652099609375, 0.50347900390625, 0.50347900390625, 0.49652099609375], [0.51068115234375, 0.48931884765625, 0.492645263671875, 0.507354736328125, 0.507354736328125, 0.492645263671875], [0.5125732421875, 0.4874267578125, 0.4884033203125, 0.5115966796875, 0.5115966796875, 0.4884033203125], [0.515380859375, 0.484619140625, 0.4775390625, 0.5224609375, 0.5224609375, 0.4775390625], [0.517852783203125, 0.482147216796875, 0.45782470703125, 0.54217529296875, 0.54217529296875, 0.45782470703125], [0.51995849609375, 0.48004150390625, 0.422119140625, 0.577880859375, 0.577880859375, 0.422119140625], [0.4764404296875, 0.5235595703125, 0.25, 0.75, 0.75, 0.25]], 
    ]

# # single focus optimizer [regular 8bit multiplier]
# improved_alpha = \
#     [
#         [[0.7509765625, 0.2490234375, 0.625, 0.375, 0.375, 0.625], [0.751953125, 0.248046875, 0.625, 0.375, 0.375, 0.625], [0.7548828125, 0.2451171875, 0.6279296875, 0.3720703125, 0.3720703125, 0.6279296875], [0.759765625, 0.240234375, 0.626953125, 0.373046875, 0.373046875, 0.626953125], [0.7705078125, 0.2294921875, 0.6396484375, 0.3603515625, 0.3603515625, 0.6396484375], [0.791015625, 0.208984375, 0.634765625, 0.365234375, 0.365234375, 0.634765625], [0.3330078125, 0.6669921875, 0.375, 0.625, 0.625, 0.375], [0.5, 0.5, 0.60546875, 0.39453125, 0.39453125, 0.60546875]], 
#         [[0.6259765625, 0.3740234375, 0.5625, 0.4375, 0.4375, 0.5625], [0.626953125, 0.373046875, 0.56298828125, 0.43701171875, 0.43701171875, 0.56298828125], [0.6298828125, 0.3701171875, 0.564453125, 0.435546875, 0.435546875, 0.564453125], [0.634765625, 0.365234375, 0.56689453125, 0.43310546875, 0.43310546875, 0.56689453125], [0.6455078125, 0.3544921875, 0.572265625, 0.427734375, 0.427734375, 0.572265625], [0.3544921875, 0.6455078125, 0.42724609375, 0.57275390625, 0.57275390625, 0.42724609375], [0.625, 0.375, 0.53271484375, 0.46728515625, 0.46728515625, 0.53271484375], [0.291015625, 0.708984375, 0.677734375, 0.322265625, 0.322265625, 0.677734375]], 
#         [[0.5634765625, 0.4365234375, 0.53125, 0.46875, 0.46875, 0.53125], [0.5654296875, 0.4345703125, 0.53173828125, 0.46826171875, 0.46826171875, 0.53173828125], [0.56884765625, 0.43115234375, 0.53466796875, 0.46533203125, 0.46533203125, 0.53466796875], [0.576171875, 0.423828125, 0.5361328125, 0.4638671875, 0.4638671875, 0.5361328125], [0.42333984375, 0.57666015625, 0.46533203125, 0.53466796875, 0.53466796875, 0.46533203125], [0.56005859375, 0.43994140625, 0.51416015625, 0.48583984375, 0.48583984375, 0.51416015625], [0.583984375, 0.416015625, 0.54296875, 0.45703125, 0.45703125, 0.54296875], [0.4208984375, 0.5791015625, 0.677734375, 0.322265625, 0.322265625, 0.677734375]], 
#         [[0.533203125, 0.466796875, 0.515625, 0.484375, 0.484375, 0.515625], [0.53466796875, 0.46533203125, 0.516357421875, 0.483642578125, 0.483642578125, 0.516357421875], [0.53857421875, 0.46142578125, 0.51806640625, 0.48193359375, 0.48193359375, 0.51806640625], [0.457763671875, 0.542236328125, 0.4794921875, 0.5205078125, 0.5205078125, 0.4794921875], [0.524169921875, 0.475830078125, 0.50390625, 0.49609375, 0.49609375, 0.50390625], [0.552734375, 0.447265625, 0.53564453125, 0.46435546875, 0.46435546875, 0.53564453125], [0.526611328125, 0.473388671875, 0.541015625, 0.458984375, 0.458984375, 0.541015625], [0.510986328125, 0.489013671875, 0.677734375, 0.322265625, 0.322265625, 0.677734375]], 
#         [[0.51708984375, 0.48291015625, 0.5078125, 0.4921875, 0.4921875, 0.5078125], [0.52001953125, 0.47998046875, 0.5089111328125, 0.4910888671875, 0.4910888671875, 0.5089111328125], [0.4783935546875, 0.5216064453125, 0.4913330078125, 0.5086669921875, 0.5086669921875, 0.4913330078125], [0.5091552734375, 0.4908447265625, 0.4996337890625, 0.5003662109375, 0.5003662109375, 0.4996337890625], [0.526123046875, 0.473876953125, 0.514404296875, 0.485595703125, 0.485595703125, 0.514404296875], [0.522705078125, 0.477294921875, 0.528076171875, 0.471923828125, 0.471923828125, 0.528076171875], [0.4893798828125, 0.5106201171875, 0.5419921875, 0.4580078125, 0.4580078125, 0.5419921875], [0.5675048828125, 0.4324951171875, 0.677734375, 0.322265625, 0.322265625, 0.677734375]], 
#         [[0.5107421875, 0.4892578125, 0.50390625, 0.49609375, 0.49609375, 0.50390625], [0.4881591796875, 0.5118408203125, 0.4940185546875, 0.5059814453125, 0.5059814453125, 0.4940185546875], [0.50408935546875, 0.49591064453125, 0.5008544921875, 0.4991455078125, 0.4991455078125, 0.5008544921875], [0.51507568359375, 0.48492431640625, 0.51031494140625, 0.48968505859375, 0.48968505859375, 0.51031494140625], [0.5101318359375, 0.4898681640625, 0.5155029296875, 0.4844970703125, 0.4844970703125, 0.5155029296875], [0.50390625, 0.49609375, 0.5291748046875, 0.4708251953125, 0.4708251953125, 0.5291748046875], [0.4654541015625, 0.5345458984375, 0.54241943359375, 0.45758056640625, 0.45758056640625, 0.54241943359375], [0.60137939453125, 0.39862060546875, 0.677734375, 0.322265625, 0.322265625, 0.677734375]], 
#         [[0.4920654296875, 0.5079345703125, 0.501953125, 0.498046875, 0.498046875, 0.501953125], [0.49993896484375, 0.50006103515625, 0.499786376953125, 0.500213623046875, 0.500213623046875, 0.499786376953125], [0.50762939453125, 0.49237060546875, 0.494476318359375, 0.505523681640625, 0.505523681640625, 0.494476318359375], [0.505859375, 0.494140625, 0.49188232421875, 0.50811767578125, 0.50811767578125, 0.49188232421875], [0.5008544921875, 0.4991455078125, 0.484893798828125, 0.515106201171875, 0.515106201171875, 0.484893798828125], [0.4920654296875, 0.5079345703125, 0.470977783203125, 0.529022216796875, 0.529022216796875, 0.470977783203125], [0.45123291015625, 0.54876708984375, 0.45684814453125, 0.54315185546875, 0.54315185546875, 0.45684814453125], [0.6209716796875, 0.3790283203125, 0.322265625, 0.677734375, 0.677734375, 0.322265625]], 
#     ]

# file 1 optimizerchr [regular 8bit multiplier]
# improved_alpha = \
#     [
#         [[0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.626953125, 0.373046875, 0.564453125, 0.435546875, 0.435546875, 0.564453125], [0.3740234375, 0.6259765625, 0.4365234375, 0.5634765625, 0.5634765625, 0.4365234375], [0.5, 0.5, 0.564453125, 0.435546875, 0.435546875, 0.564453125]], 
#         [[0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.54296875, 0.45703125, 0.5234375, 0.4765625, 0.4765625, 0.5234375], [0.3955078125, 0.6044921875, 0.4677734375, 0.5322265625, 0.5322265625, 0.4677734375], [0.583984375, 0.416015625, 0.47119140625, 0.52880859375, 0.52880859375, 0.47119140625], [0.291015625, 0.708984375, 0.6572265625, 0.3427734375, 0.3427734375, 0.6572265625]], 
#         [[0.5625, 0.4375, 0.53125, 0.46875, 0.46875, 0.53125], [0.5625, 0.4375, 0.53125, 0.46875, 0.46875, 0.53125], [0.5625, 0.4375, 0.53125, 0.46875, 0.46875, 0.53125], [0.51171875, 0.48828125, 0.5078125, 0.4921875, 0.4921875, 0.5078125], [0.447265625, 0.552734375, 0.490234375, 0.509765625, 0.509765625, 0.490234375], [0.5234375, 0.4765625, 0.47607421875, 0.52392578125, 0.52392578125, 0.47607421875], [0.55810546875, 0.44189453125, 0.49609375, 0.50390625, 0.50390625, 0.49609375], [0.42041015625, 0.57958984375, 0.6572265625, 0.3427734375, 0.3427734375, 0.6572265625]], 
#         [[0.53125, 0.46875, 0.515625, 0.484375, 0.484375, 0.515625], [0.53125, 0.46875, 0.515625, 0.484375, 0.484375, 0.515625], [0.501953125, 0.498046875, 0.5048828125, 0.4951171875, 0.4951171875, 0.5048828125], [0.47265625, 0.52734375, 0.49365234375, 0.50634765625, 0.50634765625, 0.49365234375], [0.50244140625, 0.49755859375, 0.478515625, 0.521484375, 0.521484375, 0.478515625], [0.51953125, 0.48046875, 0.503662109375, 0.496337890625, 0.496337890625, 0.503662109375], [0.4814453125, 0.5185546875, 0.49658203125, 0.50341796875, 0.50341796875, 0.49658203125], [0.52099609375, 0.47900390625, 0.6572265625, 0.3427734375, 0.3427734375, 0.6572265625]], 
#         [[0.515625, 0.484375, 0.5078125, 0.4921875, 0.4921875, 0.5078125], [0.4990234375, 0.5009765625, 0.50244140625, 0.49755859375, 0.49755859375, 0.50244140625], [0.48681640625, 0.51318359375, 0.499755859375, 0.500244140625, 0.500244140625, 0.499755859375], [0.49560546875, 0.50439453125, 0.486328125, 0.513671875, 0.513671875, 0.486328125], [0.505615234375, 0.494384765625, 0.493896484375, 0.506103515625, 0.506103515625, 0.493896484375], [0.47412109375, 0.52587890625, 0.493408203125, 0.506591796875, 0.506591796875, 0.493408203125], [0.431884765625, 0.568115234375, 0.4998779296875, 0.5001220703125, 0.5001220703125, 0.4998779296875], [0.5880126953125, 0.4119873046875, 0.6572265625, 0.3427734375, 0.3427734375, 0.6572265625]], 
#         [[0.4970703125, 0.5029296875, 0.50390625, 0.49609375, 0.49609375, 0.50390625], [0.492919921875, 0.507080078125, 0.4970703125, 0.5029296875, 0.5029296875, 0.4970703125], [0.4959716796875, 0.5040283203125, 0.492919921875, 0.507080078125, 0.507080078125, 0.492919921875], [0.50146484375, 0.49853515625, 0.49835205078125, 0.50164794921875, 0.50164794921875, 0.49835205078125], [0.4798583984375, 0.5201416015625, 0.49456787109375, 0.50543212890625, 0.50543212890625, 0.49456787109375], [0.4462890625, 0.5537109375, 0.494384765625, 0.505615234375, 0.505615234375, 0.494384765625], [0.39935302734375, 0.60064697265625, 0.5015869140625, 0.4984130859375, 0.4984130859375, 0.5015869140625], [0.6298828125, 0.3701171875, 0.6572265625, 0.3427734375, 0.3427734375, 0.6572265625]], 
#         [[0.494384765625, 0.505615234375, 0.501953125, 0.498046875, 0.498046875, 0.501953125], [0.4951171875, 0.5048828125, 0.50390625, 0.49609375, 0.49609375, 0.50390625], [0.4996337890625, 0.5003662109375, 0.500823974609375, 0.499176025390625, 0.499176025390625, 0.500823974609375], [0.486297607421875, 0.513702392578125, 0.504302978515625, 0.495697021484375, 0.495697021484375, 0.504302978515625], [0.464569091796875, 0.535430908203125, 0.50592041015625, 0.49407958984375, 0.49407958984375, 0.50592041015625], [0.428955078125, 0.571044921875, 0.505584716796875, 0.494415283203125, 0.494415283203125, 0.505584716796875], [0.379608154296875, 0.620391845703125, 0.4970703125, 0.5029296875, 0.5029296875, 0.4970703125], [0.654754638671875, 0.345245361328125, 0.3427734375, 0.6572265625, 0.6572265625, 0.3427734375]], 
#     ]


# FA[2][3], t0, focus optimization
improved_alpha = \
[
    [[0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.75, 0.25, 0.625, 0.375, 0.375, 0.625], [0.6484375, 0.3515625, 0.49609375, 0.50390625, 0.50390625, 0.49609375], [0.25, 0.75, 0.375, 0.625, 0.625, 0.375], [0.5, 0.5, 0.75, 0.25, 0.25, 0.75]], 
    [[0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.625, 0.375, 0.5625, 0.4375, 0.4375, 0.5625], [0.453125, 0.546875, 0.3984375, 0.6015625, 0.6015625, 0.3984375], [0.375, 0.625, 0.4375, 0.5625, 0.5625, 0.4375], [0.7080078125, 0.2919921875, 0.6005859375, 0.3994140625, 0.3994140625, 0.6005859375], [0.1328125, 0.8671875, 0.740234375, 0.259765625, 0.259765625, 0.740234375]], 
    [[0.5625, 0.4375, 0.53125, 0.46875, 0.46875, 0.53125], [0.5625, 0.4375, 0.53125, 0.46875, 0.46875, 0.53125], [0.5625, 0.4375, 0.53125, 0.46875, 0.46875, 0.53125], [0.29296875, 0.70703125, 0.41015625, 0.58984375, 0.58984375, 0.41015625], [0.4375, 0.5625, 0.46875, 0.53125, 0.53125, 0.46875], [0.6083984375, 0.3916015625, 0.5478515625, 0.4521484375, 0.4521484375, 0.5478515625], [0.63134765625, 0.36865234375, 0.56005859375, 0.43994140625, 0.43994140625, 0.56005859375], [0.26123046875, 0.73876953125, 0.75, 0.25, 0.25, 0.75]], 
    [[0.53125, 0.46875, 0.515625, 0.484375, 0.484375, 0.515625], [0.53125, 0.46875, 0.515625, 0.484375, 0.484375, 0.515625], [0.37890625, 0.62109375, 0.455078125, 0.544921875, 0.544921875, 0.455078125], [0.46875, 0.53125, 0.484375, 0.515625, 0.515625, 0.484375], [0.5556640625, 0.4443359375, 0.52099609375, 0.47900390625, 0.47900390625, 0.52099609375], [0.5615234375, 0.4384765625, 0.52685546875, 0.47314453125, 0.47314453125, 0.52685546875], [0.579345703125, 0.420654296875, 0.557373046875, 0.442626953125, 0.442626953125, 0.557373046875], [0.3427734375, 0.6572265625, 0.75, 0.25, 0.25, 0.75]], 
    [[0.515625, 0.484375, 0.5078125, 0.4921875, 0.4921875, 0.5078125], [0.42578125, 0.57421875, 0.482421875, 0.517578125, 0.517578125, 0.482421875], [0.484375, 0.515625, 0.4921875, 0.5078125, 0.5078125, 0.4921875], [0.52783203125, 0.47216796875, 0.509765625, 0.490234375, 0.490234375, 0.509765625], [0.525634765625, 0.474365234375, 0.50390625, 0.49609375, 0.49609375, 0.50390625], [0.528564453125, 0.471435546875, 0.5228271484375, 0.4771728515625, 0.4771728515625, 0.5228271484375], [0.5367431640625, 0.4632568359375, 0.5543212890625, 0.4456787109375, 0.4456787109375, 0.5543212890625], [0.4024658203125, 0.5975341796875, 0.75, 0.25, 0.25, 0.75]], 
    [[0.45703125, 0.54296875, 0.50390625, 0.49609375, 0.49609375, 0.50390625], [0.4921875, 0.5078125, 0.49609375, 0.50390625, 0.50390625, 0.49609375], [0.51513671875, 0.48486328125, 0.5048828125, 0.4951171875, 0.4951171875, 0.5048828125], [0.5057373046875, 0.4942626953125, 0.5003662109375, 0.4996337890625, 0.4996337890625, 0.5003662109375], [0.50225830078125, 0.49774169921875, 0.50146484375, 0.49853515625, 0.49853515625, 0.50146484375], [0.50421142578125, 0.49578857421875, 0.520751953125, 0.479248046875, 0.479248046875, 0.520751953125], [0.50579833984375, 0.49420166015625, 0.5560302734375, 0.4439697265625, 0.4439697265625, 0.5560302734375], [0.442626953125, 0.557373046875, 0.75, 0.25, 0.25, 0.75]], 
    [[0.49609375, 0.50390625, 0.501953125, 0.498046875, 0.498046875, 0.501953125], [0.5059814453125, 0.4940185546875, 0.49835205078125, 0.50164794921875, 0.50164794921875, 0.49835205078125], [0.5018310546875, 0.4981689453125, 0.499908447265625, 0.500091552734375, 0.500091552734375, 0.499908447265625], [0.488983154296875, 0.511016845703125, 0.5037841796875, 0.4962158203125, 0.4962158203125, 0.5037841796875], [0.487518310546875, 0.512481689453125, 0.49627685546875, 0.50372314453125, 0.50372314453125, 0.49627685546875], [0.485504150390625, 0.514495849609375, 0.478790283203125, 0.521209716796875, 0.521209716796875, 0.478790283203125], [0.486602783203125, 0.513397216796875, 0.443878173828125, 0.556121826171875, 0.556121826171875, 0.443878173828125], [0.467620849609375, 0.532379150390625, 0.25, 0.75, 0.75, 0.25]], 
]


def generate_body_voltage(alpha_lst, t_sec, bit_len):
    # equation starts from 1s
    if t_sec <= 0:
        t_sec = 10

    body_voltage = []
    
    for layer in range(bit_len-1):
        lay_v = []
        for fa_index in range(bit_len):
            tmp_v_T = []
            for t_index in range(6):
                _vth_base = abs(NBTI.Vth)
                _vth_growth = NBTI.delta_vth(NBTI.Vdef, NBTI.T, alpha_lst[layer][fa_index][t_index], NBTI.Tclk, t_sec)
                if FAULTY_TRANSISTOR:
                    if \
                        (layer == FAULTY_TRANSISTOR['lay']) and \
                        (fa_index == FAULTY_TRANSISTOR['fa_index']) and \
                        (t_index == FAULTY_TRANSISTOR['t_index']):
                        _vth_base *= FAULTY_VTH_BASE
                        _vth_growth *= FAULTY_VTH_GROWTH_RATE

                _vth = _vth_base + _vth_growth
                _vb = VTH.get_body_voltage(_vth)
                tmp_v_T.append(_vb)

            lay_v.append(tmp_v_T)
        body_voltage.append(lay_v)
    return body_voltage
    


initial_v_base = VTH.get_body_voltage(vth=abs(NBTI.Vth))
current_base = get_current_from_pb(initial_v_base)
current_fail = current_base * (1-0.5)
vb_fail = get_pb_from_current(current_fail)
# log.println(f"BASE Vbody [{initial_v_base}] FAIL Vbody [{vb_fail}] BASE I [{current_base}] FAIL I [{current_fail}]")

if __name__ == "__main__":
    if True:
        __normal_fail = True
        __optimized_fail = True

        for t_week in range(0, 200, 1):
            t_sec = t_week * 7 * 24 * 60 * 60

            normal_body_voltage = generate_body_voltage(normal_alpha, t_sec, bit_len)
            optimized_body_voltage = generate_body_voltage(improved_alpha, t_sec, bit_len)

            for fa_i in range(bit_len-1):
                for fa_j in range(bit_len):
                    for t_index in range(6):
                    
                        if __normal_fail and (normal_body_voltage[fa_i][fa_j][t_index] >= vb_fail):
                            log.println("alpha: [NORMAL]")
                            log.println(f"FA[{fa_i}][{fa_j}], transistor[{t_index}] failed at week [{t_week}], {normal_body_voltage[fa_i][fa_j][t_index]} >= {vb_fail}")
                            __normal_fail = False
                        if __optimized_fail and (optimized_body_voltage[fa_i][fa_j][t_index] >= vb_fail):
                            log.println("alpha: [OPTIMIZED]")
                            log.println(f"FA[{fa_i}][{fa_j}], transistor[{t_index}] failed at week [{t_week}], {optimized_body_voltage[fa_i][fa_j][t_index]} >= {vb_fail}")
                            __optimized_fail = False
                            
