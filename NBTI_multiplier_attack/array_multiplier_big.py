

"""
"""

from tool.log import Log
from tool import NBTI_formula as BTI
from msimulator.bin_func import signed_b,reverse_signed_b
from msimulator.Multiplier import MPn_rew
from alpha_shrinked import AlphaSampled

from mapping_tgate_pb_delay import tgate_pb_to_delay
from mapping_pmos_vth_body import pmos_vth_to_body

from propagation_delay import array_multiplier_error_rate

import matplotlib.pyplot as plt
from datetime import datetime

BIT_LEN = 16
TEMP = 273.15 + 80
ALPHA_VERIFICATION = False
ALPHA_SAMPLE_COUNT = 500_000    # reduced from 10M to 500k
RND_SEED = 7
PROCESS_COUNT = 10
log = Log(f"{__file__}.{BIT_LEN}.MAll.log", terminal=True)

########################################################################################
################## Critical Path
########################################################################################

"""range(bit_len-1)"""
def create_crit(i_th) -> list:
    crit = []
    for lay in range(1, BIT_LEN-2):
        crit += [(lay, i_th), (lay, i_th + 1)]
    crit += [(0, i) for i in range(0, i_th + 2)]
    crit += [(BIT_LEN-2, i) for i in range(i_th, BIT_LEN)]
    return crit

"""for multiplier propagation delay and optimization"""
"""all FA in first row + last 2 FA in each row """
CRITICAL_FA_lst = create_crit(BIT_LEN - 2)
log.println(f"Critical eFA list: {CRITICAL_FA_lst}")

no_tamper = \
[]
no_tamper_alpha = \
[[[0.7501686, 0.24983140000000004, 0.6253235, 0.37467649999999997, 0.37467649999999997, 0.6253235], [0.7501243, 0.24987570000000003, 0.6249852, 0.3750148, 0.3750148, 0.6249852], [0.7501112, 0.24988880000000002, 0.6252045, 0.37479549999999995, 0.37479549999999995, 0.6252045], [0.7497442, 0.25025580000000003, 0.6250686, 0.3749314, 0.3749314, 0.6250686], [0.749923, 0.250077, 0.6248692, 0.3751308, 0.3751308, 0.6248692], [0.7501792, 0.24982079999999995, 0.6251995, 0.3748005, 0.3748005, 0.6251995], [0.7499572, 0.2500428, 0.6250073, 0.37499269999999996, 0.37499269999999996, 0.6250073], [0.7499841, 0.25001589999999996, 0.6250801, 0.3749199, 0.3749199, 0.6250801], [0.7499435, 0.2500565, 0.6249822, 0.37501779999999996, 0.37501779999999996, 0.6249822], [0.7500262, 0.24997380000000002, 0.6250553, 0.3749447, 0.3749447, 0.6250553], [0.7499599, 0.2500401, 0.6250467, 0.37495330000000004, 0.37495330000000004, 0.6250467], [0.75008, 0.24992000000000003, 0.6249412, 0.3750588, 0.3750588, 0.6249412], [0.7500653, 0.24993469999999995, 0.6250513, 0.3749487, 0.3749487, 0.6250513], [0.7499881, 0.25001189999999995, 0.6252665, 0.37473350000000005, 0.37473350000000005, 0.6252665], [0.2502054, 0.7497946, 0.374938, 0.625062, 0.625062, 0.374938], [0.0, 1.0, 0.7497842, 0.2502158, 0.2502158, 0.7497842]], [[0.6250904, 0.37490959999999995, 0.5624192, 0.4375808, 0.4375808, 0.5624192], [0.6251775, 0.37482249999999995, 0.5625909, 0.4374091, 0.4374091, 0.5625909], [0.6249393, 0.3750607, 0.5624416, 0.4375584, 0.4375584, 0.5624416], [0.6251423, 0.37485769999999996, 0.5624804, 0.4375196, 0.4375196, 0.5624804], [0.6252772, 0.3747228, 0.5626937, 0.43730630000000004, 0.43730630000000004, 0.5626937], [0.6249542, 0.3750458, 0.562194, 0.43780600000000003, 0.43780600000000003, 0.562194], [0.6250647, 0.37493529999999997, 0.5626711, 0.4373289, 0.4373289, 0.5626711], [0.6250748, 0.37492519999999996, 0.5625903, 0.4374097, 0.4374097, 0.5625903], [0.6249688, 0.3750312, 0.5624081, 0.43759190000000003, 0.43759190000000003, 0.5624081], [0.6251887, 0.37481129999999996, 0.562627, 0.437373, 0.437373, 0.562627], [0.6250245, 0.3749755, 0.5623757, 0.43762429999999997, 0.43762429999999997, 0.5623757], [0.62507, 0.37493, 0.5627247, 0.43727530000000003, 0.43727530000000003, 0.5627247], [0.6251863, 0.3748137, 0.5627657, 0.43723429999999996, 0.43723429999999996, 0.5627657], [0.3751086, 0.6248914, 0.4375619, 0.5624381, 0.5624381, 0.4375619], [0.7084543, 0.2915457, 0.6040715, 0.3959285, 0.3959285, 0.6040715], [0.145924, 0.8540760000000001, 0.749669, 0.25033099999999997, 0.25033099999999997, 0.749669]], [[0.5626926, 0.4373074, 0.5314414, 0.46855860000000005, 0.46855860000000005, 0.5314414], [0.5624215, 0.4375785, 0.5310797, 0.46892029999999996, 0.46892029999999996, 0.5310797], [0.5625368, 0.43746320000000005, 0.531246, 0.468754, 0.468754, 0.531246], [0.5625419, 0.43745809999999996, 0.5312419, 0.46875809999999996, 0.46875809999999996, 0.5312419], [0.5622559, 0.43774409999999997, 0.5313071, 0.46869289999999997, 0.46869289999999997, 0.5313071], [0.5624021, 0.4375979, 0.5311593, 0.4688407, 0.4688407, 0.5311593], [0.5623238, 0.43767619999999996, 0.531456, 0.46854399999999996, 0.46854399999999996, 0.531456], [0.5624251, 0.4375749, 0.5312346, 0.4687654, 0.4687654, 0.5312346], [0.562849, 0.43715099999999996, 0.5313542, 0.4686458, 0.4686458, 0.5313542], [0.562149, 0.437851, 0.5312006, 0.4687994, 0.4687994, 0.5312006], [0.5627676, 0.43723239999999997, 0.53141, 0.46858999999999995, 0.46858999999999995, 0.53141], [0.5627557, 0.43724430000000003, 0.5313124, 0.4686876, 0.4686876, 0.5313124], [0.4374766, 0.5625234, 0.4685508, 0.5314492, 0.5314492, 0.4685508], [0.6078548, 0.39214519999999997, 0.5538632, 0.4461368, 0.4461368, 0.5538632], [0.6450728, 0.3549272, 0.5861542, 0.41384580000000004, 0.41384580000000004, 0.5861542], [0.2756339, 0.7243661, 0.7498164, 0.25018359999999995, 0.25018359999999995, 0.7498164]], [[0.5310709, 0.4689291, 0.5155367, 0.48446330000000004, 0.48446330000000004, 0.5155367], [0.5311671, 0.4688329, 0.5155785, 0.48442149999999995, 0.48442149999999995, 0.5155785], [0.5313568, 0.46864320000000004, 0.5157205, 0.4842795, 0.4842795, 0.5157205], [0.5311352, 0.46886479999999997, 0.5154696, 0.4845304, 0.4845304, 0.5154696], [0.5313486, 0.46865140000000005, 0.5156646, 0.48433539999999997, 0.48433539999999997, 0.5156646], [0.5313003, 0.46869970000000005, 0.515714, 0.484286, 0.484286, 0.515714], [0.5313103, 0.4686897, 0.5152953, 0.4847047, 0.4847047, 0.5152953], [0.5315544, 0.4684456, 0.5156139, 0.48438610000000004, 0.48438610000000004, 0.5156139], [0.5312509, 0.46874910000000003, 0.5156136, 0.4843864, 0.4843864, 0.5156136], [0.5315204, 0.4684796, 0.5157575, 0.4842425, 0.4842425, 0.5157575], [0.5313854, 0.4686146, 0.5156387, 0.4843613, 0.4843613, 0.5156387], [0.4687314, 0.5312686, 0.4844982, 0.5155018, 0.5155018, 0.4844982], [0.5550413, 0.44495870000000004, 0.5273524, 0.47264759999999995, 0.47264759999999995, 0.5273524], [0.5751876, 0.4248124, 0.5466949, 0.4533051, 0.4533051, 0.5466949], [0.5934673, 0.40653269999999997, 0.5799381, 0.4200619, 0.4200619, 0.5799381], [0.3653036, 0.6346963999999999, 0.7497638, 0.2502362, 0.2502362, 0.7497638]], [[0.5154828, 0.4845172, 0.5079546, 0.49204539999999997, 0.49204539999999997, 0.5079546], [0.5156811, 0.4843189, 0.5078782, 0.49212180000000005, 0.49212180000000005, 0.5078782], [0.5154293, 0.4845707, 0.5075453, 0.4924547, 0.4924547, 0.5075453], [0.5156551, 0.48434489999999997, 0.5075213, 0.49247870000000005, 0.49247870000000005, 0.5075213], [0.5155773, 0.4844227, 0.5076264, 0.49237359999999997, 0.49237359999999997, 0.5076264], [0.5157332, 0.4842668, 0.508169, 0.491831, 0.491831, 0.508169], [0.5157062, 0.4842938, 0.5076789, 0.49232109999999996, 0.49232109999999996, 0.5076789], [0.5157463, 0.4842537, 0.5078789, 0.4921211, 0.4921211, 0.5078789], [0.5157717, 0.48422829999999994, 0.5078518, 0.49214820000000004, 0.49214820000000004, 0.5078518], [0.5155979, 0.48440209999999995, 0.5077143, 0.49228570000000005, 0.49228570000000005, 0.5077143], [0.4844724, 0.5155276, 0.4925228, 0.5074772000000001, 0.5074772000000001, 0.4925228], [0.5279031, 0.47209690000000004, 0.5138016, 0.48619840000000003, 0.48619840000000003, 0.5138016], [0.538273, 0.461727, 0.5231614, 0.4768386, 0.4768386, 0.5231614], [0.5483028, 0.4516972, 0.5432622, 0.45673779999999997, 0.45673779999999997, 0.5432622], [0.5572507, 0.4427493, 0.5779978, 0.4220022, 0.4220022, 0.5779978], [0.4217743, 0.5782257, 0.749667, 0.250333, 0.250333, 0.749667]], [[0.5079601, 0.4920399, 0.5040832, 0.49591680000000005, 0.49591680000000005, 0.5040832], [0.5075815, 0.4924185, 0.5037915, 0.49620850000000005, 0.49620850000000005, 0.5037915], [0.5075501, 0.4924499, 0.5034966, 0.49650340000000004, 0.49650340000000004, 0.5034966], [0.5077172, 0.4922828, 0.5038287, 0.4961713, 0.4961713, 0.5038287], [0.5079237, 0.4920763, 0.5038656, 0.4961344, 0.4961344, 0.5038656], [0.5077943, 0.49220569999999997, 0.5041647, 0.4958353, 0.4958353, 0.5041647], [0.5077947, 0.49220529999999996, 0.5034933, 0.49650669999999997, 0.49650669999999997, 0.5034933], [0.5077812, 0.49221879999999996, 0.5037746, 0.49622540000000004, 0.49622540000000004, 0.5037746], [0.5076561, 0.49234389999999995, 0.5039163, 0.4960837, 0.4960837, 0.5039163], [0.4921569, 0.5078431, 0.4961987, 0.5038013, 0.5038013, 0.4961987], [0.5139303, 0.48606970000000005, 0.5071014, 0.49289859999999996, 0.49289859999999996, 0.5071014], [0.5191083, 0.48089170000000003, 0.5115691, 0.4884309, 0.4884309, 0.5115691], [0.5247415, 0.47525850000000003, 0.5219248, 0.47807520000000003, 0.47807520000000003, 0.5219248], [0.5292363, 0.4707637, 0.5417191, 0.4582809, 0.4582809, 0.5417191], [0.533718, 0.466282, 0.5770465, 0.4229535, 0.4229535, 0.5770465], [0.4557027, 0.5442973, 0.7499178, 0.25008220000000003, 0.25008220000000003, 0.7499178]], [[0.50379, 0.49621000000000004, 0.5020438, 0.49795619999999996, 0.49795619999999996, 0.5020438], [0.503747, 0.49625300000000006, 0.5019088, 0.49809119999999996, 0.49809119999999996, 0.5019088], [0.5036463, 0.4963537, 0.501813, 0.49818700000000005, 0.49818700000000005, 0.501813], [0.5038377, 0.49616229999999995, 0.5021685, 0.4978315, 0.4978315, 0.5021685], [0.504045, 0.49595500000000003, 0.5020484, 0.49795160000000005, 0.49795160000000005, 0.5020484], [0.5037659, 0.4962341, 0.5019073, 0.49809270000000005, 0.49809270000000005, 0.5019073], [0.5038294, 0.4961706, 0.5016847, 0.4983153, 0.4983153, 0.5016847], [0.503922, 0.496078, 0.5019496, 0.4980504, 0.4980504, 0.5019496], [0.4960917, 0.5039083, 0.4981243, 0.5018757, 0.5018757, 0.4981243], [0.5071385, 0.49286149999999995, 0.5037615, 0.4962385, 0.4962385, 0.5037615], [0.509761, 0.490239, 0.5060509, 0.49394910000000003, 0.49394910000000003, 0.5060509], [0.5122483, 0.4877517, 0.5108244, 0.48917560000000004, 0.48917560000000004, 0.5108244], [0.5147499, 0.4852501, 0.5213109, 0.4786891, 0.4786891, 0.5213109], [0.5171835, 0.4828165, 0.5410042, 0.45899579999999995, 0.45899579999999995, 0.5410042], [0.5196978, 0.4803022, 0.5770658, 0.42293420000000004, 0.42293420000000004, 0.5770658], [0.4753508, 0.5246492, 0.7497585, 0.2502415, 0.2502415, 0.7497585]], [[0.5019903, 0.4980097, 0.5010986, 0.49890140000000005, 0.49890140000000005, 0.5010986], [0.5016914, 0.4983086, 0.5008904, 0.49910960000000004, 0.49910960000000004, 0.5008904], [0.5019885, 0.49801150000000005, 0.5009892, 0.4990108, 0.4990108, 0.5009892], [0.5020911, 0.4979089, 0.5012308, 0.4987692, 0.4987692, 0.5012308], [0.5018496, 0.4981504, 0.5009104, 0.4990896, 0.4990896, 0.5009104], [0.5016924, 0.49830759999999996, 0.5008925, 0.49910750000000004, 0.49910750000000004, 0.5008925], [0.5018563, 0.49814369999999997, 0.5009445, 0.4990555, 0.4990555, 0.5009445], [0.4979823, 0.5020177, 0.4991246, 0.5008754, 0.5008754, 0.4991246], [0.5037303, 0.49626970000000004, 0.5020207, 0.4979793, 0.4979793, 0.5020207], [0.5050502, 0.4949498, 0.5029653, 0.49703470000000005, 0.49703470000000005, 0.5029653], [0.5059733, 0.49402670000000004, 0.5054516, 0.4945484, 0.4945484, 0.5054516], [0.5075322, 0.4924678, 0.511099, 0.48890100000000003, 0.48890100000000003, 0.511099], [0.5086224, 0.49137759999999997, 0.5211753, 0.4788247, 0.4788247, 0.5211753], [0.5101769, 0.48982309999999996, 0.5408605, 0.45913950000000003, 0.45913950000000003, 0.5408605], [0.5108766, 0.4891234, 0.5766489, 0.4233511, 0.4233511, 0.5766489], [0.4865769, 0.5134231, 0.7496268, 0.25037319999999996, 0.25037319999999996, 0.7496268]], [[0.5008361, 0.4991639, 0.500456, 0.499544, 0.499544, 0.500456], [0.500923, 0.499077, 0.5004403, 0.49955970000000005, 0.49955970000000005, 0.5004403], [0.5011603, 0.4988397, 0.5006855, 0.4993145, 0.4993145, 0.5006855], [0.5009519, 0.4990481, 0.5005705, 0.49942949999999997, 0.49942949999999997, 0.5005705], [0.5009006, 0.49909939999999997, 0.5003561, 0.49964390000000003, 0.49964390000000003, 0.5003561], [0.5010915, 0.4989085, 0.5007871, 0.49921289999999996, 0.49921289999999996, 0.5007871], [0.4991115, 0.5008885000000001, 0.4994269, 0.5005731, 0.5005731, 0.4994269], [0.5018669, 0.4981331, 0.5009077, 0.49909230000000004, 0.49909230000000004, 0.5009077], [0.5023958, 0.49760420000000005, 0.5012991, 0.4987009, 0.4987009, 0.5012991], [0.5030636, 0.49693639999999994, 0.5027099, 0.49729009999999996, 0.49729009999999996, 0.5027099], [0.5040143, 0.4959857, 0.5056629, 0.4943371, 0.4943371, 0.5056629], [0.5046238, 0.49537620000000004, 0.5107563, 0.48924369999999995, 0.48924369999999995, 0.5107563], [0.5051552, 0.4948448, 0.5210878, 0.4789122, 0.4789122, 0.5210878], [0.505661, 0.494339, 0.5409693, 0.4590307, 0.4590307, 0.5409693], [0.5056426, 0.49435739999999995, 0.5762687, 0.42373130000000003, 0.42373130000000003, 0.5762687], [0.4928298, 0.5071702, 0.7496282, 0.25037180000000003, 0.25037180000000003, 0.7496282]], [[0.5005196, 0.49948040000000005, 0.5003078, 0.49969220000000003, 0.49969220000000003, 0.5003078], [0.5006958, 0.4993042, 0.5003419, 0.4996581, 0.4996581, 0.5003419], [0.5003985, 0.49960150000000003, 0.5003773, 0.4996227, 0.4996227, 0.5003773], [0.5002712, 0.4997288, 0.5000338, 0.4999662, 0.4999662, 0.5000338], [0.5006494, 0.4993506, 0.5004575, 0.4995425, 0.4995425, 0.5004575], [0.4995777, 0.5004223, 0.4998913, 0.5001087, 0.5001087, 0.4998913], [0.5008225, 0.49917750000000005, 0.5004862, 0.4995138, 0.4995138, 0.5004862], [0.5012095, 0.4987905, 0.5007258, 0.4992742, 0.4992742, 0.5007258], [0.5014352, 0.49856480000000003, 0.5013423, 0.4986577, 0.4986577, 0.5013423], [0.5019179, 0.49808209999999997, 0.5026336, 0.4973664, 0.4973664, 0.5026336], [0.5022234, 0.4977766, 0.5054613, 0.4945387, 0.4945387, 0.5054613], [0.5026474, 0.49735260000000003, 0.5107105, 0.48928950000000004, 0.48928950000000004, 0.5107105], [0.5030588, 0.49694119999999997, 0.5213178, 0.47868219999999995, 0.47868219999999995, 0.5213178], [0.5025932, 0.49740680000000004, 0.5406278, 0.4593722, 0.4593722, 0.5406278], [0.5031103, 0.4968897, 0.5767006, 0.4232994, 0.4232994, 0.5767006], [0.4963221, 0.5036779, 0.7497953, 0.25020469999999995, 0.25020469999999995, 0.7497953]], [[0.5002854, 0.4997146, 0.5002205, 0.49977950000000004, 0.49977950000000004, 0.5002205], [0.5003971, 0.49960289999999996, 0.5003548, 0.4996452, 0.4996452, 0.5003548], [0.499925, 0.500075, 0.499991, 0.5000089999999999, 0.5000089999999999, 0.499991], [0.5003344, 0.49966560000000004, 0.5002134, 0.49978659999999997, 0.49978659999999997, 0.5002134], [0.4996372, 0.5003628, 0.4996834, 0.5003166, 0.5003166, 0.4996834], [0.5003734, 0.49962660000000003, 0.5002911, 0.4997089, 0.4997089, 0.5002911], [0.5006588, 0.49934120000000004, 0.5002794, 0.49972059999999996, 0.49972059999999996, 0.5002794], [0.5006601, 0.49933989999999995, 0.5007011, 0.4992989, 0.4992989, 0.5007011], [0.5007055, 0.4992945, 0.5013842, 0.49861580000000005, 0.49861580000000005, 0.5013842], [0.5012079, 0.49879209999999996, 0.5026977, 0.4973023, 0.4973023, 0.5026977], [0.5012316, 0.4987684, 0.5051992, 0.49480080000000004, 0.49480080000000004, 0.5051992], [0.501522, 0.498478, 0.510792, 0.489208, 0.489208, 0.510792], [0.5013215, 0.4986785, 0.5210239, 0.4789761, 0.4789761, 0.5210239], [0.501705, 0.49829500000000004, 0.5407571, 0.4592429, 0.4592429, 0.5407571], [0.5015625, 0.4984375, 0.5767559, 0.4232441, 0.4232441, 0.5767559], [0.4982321, 0.5017678999999999, 0.7496068, 0.2503932, 0.2503932, 0.7496068]], [[0.500291, 0.49970899999999996, 0.4999654, 0.5000346, 0.5000346, 0.4999654], [0.5000035, 0.49999649999999995, 0.4999742, 0.5000258, 0.5000258, 0.4999742], [0.5001392, 0.4998608, 0.4999717, 0.5000283, 0.5000283, 0.4999717], [0.4996368, 0.5003632, 0.4999295, 0.5000705, 0.5000705, 0.4999295], [0.5001832, 0.49981679999999995, 0.5000996, 0.4999004, 0.4999004, 0.5000996], [0.5002105, 0.4997895, 0.5000152, 0.4999848, 0.4999848, 0.5000152], [0.5004139, 0.49958610000000003, 0.500415, 0.49958499999999995, 0.49958499999999995, 0.500415], [0.500369, 0.49963100000000005, 0.5005387, 0.4994613, 0.4994613, 0.5005387], [0.5003576, 0.49964240000000004, 0.5012989, 0.4987011, 0.4987011, 0.5012989], [0.5006806, 0.49931939999999997, 0.5027098, 0.4972902, 0.4972902, 0.5027098], [0.5005568, 0.4994432, 0.5053688, 0.49463120000000005, 0.49463120000000005, 0.5053688], [0.5005371, 0.49946290000000004, 0.5106144, 0.4893856, 0.4893856, 0.5106144], [0.5006937, 0.4993063, 0.5212598, 0.47874019999999995, 0.47874019999999995, 0.5212598], [0.5008344, 0.4991656, 0.540968, 0.459032, 0.459032, 0.540968], [0.5006385, 0.4993615, 0.5764841, 0.42351589999999995, 0.42351589999999995, 0.5764841], [0.4992804, 0.5007196, 0.7499862, 0.25001379999999995, 0.25001379999999995, 0.7499862]], [[0.4999651, 0.5000349, 0.4998159, 0.5001841, 0.5001841, 0.4998159], [0.4999866, 0.5000134, 0.5000445, 0.4999555, 0.4999555, 0.5000445], [0.4997389, 0.5002611, 0.4998293, 0.5001707, 0.5001707, 0.4998293], [0.5000235, 0.49997650000000005, 0.5001046, 0.4998954, 0.4998954, 0.5001046], [0.5001469, 0.49985310000000005, 0.5000008, 0.4999992, 0.4999992, 0.5000008], [0.5002303, 0.4997697, 0.5001285, 0.4998715, 0.4998715, 0.5001285], [0.5001769, 0.49982309999999996, 0.5003841, 0.4996159, 0.4996159, 0.5003841], [0.5003107, 0.4996893, 0.5008703, 0.4991297, 0.4991297, 0.5008703], [0.5004722, 0.49952779999999997, 0.5014886, 0.49851140000000005, 0.49851140000000005, 0.5014886], [0.5004784, 0.4995216, 0.5030793, 0.4969207, 0.4969207, 0.5030793], [0.5000168, 0.49998319999999996, 0.5053522, 0.49464779999999997, 0.49464779999999997, 0.5053522], [0.5006006, 0.49939940000000005, 0.5107655, 0.4892345, 0.4892345, 0.5107655], [0.500588, 0.49941199999999997, 0.5211319, 0.4788681, 0.4788681, 0.5211319], [0.5002473, 0.49975270000000005, 0.5406079, 0.45939209999999997, 0.45939209999999997, 0.5406079], [0.5003023, 0.4996977, 0.576681, 0.423319, 0.423319, 0.576681], [0.4998283, 0.5001717, 0.7496685, 0.25033150000000004, 0.25033150000000004, 0.7496685]], [[0.500028, 0.49997199999999997, 0.5000555, 0.4999445, 0.4999445, 0.5000555], [0.4998803, 0.5001197, 0.5000735, 0.49992650000000005, 0.49992650000000005, 0.5000735], [0.5001109, 0.4998891, 0.5000128, 0.49998719999999996, 0.49998719999999996, 0.5000128], [0.4999543, 0.5000457, 0.4998274, 0.5001726, 0.5001726, 0.4998274], [0.4999578, 0.5000422, 0.4998899, 0.5001101, 0.5001101, 0.4998899], [0.5000114, 0.4999886, 0.5002827, 0.49971730000000003, 0.49971730000000003, 0.5002827], [0.5000915, 0.4999085, 0.5002613, 0.4997387, 0.4997387, 0.5002613], [0.500149, 0.49985100000000005, 0.5006341, 0.49936590000000003, 0.49936590000000003, 0.5006341], [0.5001584, 0.4998416, 0.501707, 0.498293, 0.498293, 0.501707], [0.5000953, 0.4999047, 0.5027699, 0.4972301, 0.4972301, 0.5027699], [0.500054, 0.499946, 0.5052329, 0.4947671, 0.4947671, 0.5052329], [0.5005759, 0.49942410000000004, 0.5109994, 0.4890006, 0.4890006, 0.5109994], [0.5000936, 0.4999064, 0.5206535, 0.4793465, 0.4793465, 0.5206535], [0.500201, 0.499799, 0.5409521, 0.45904789999999995, 0.45904789999999995, 0.5409521], [0.499979, 0.500021, 0.5765947, 0.4234053, 0.4234053, 0.5765947], [0.5001335, 0.4998665, 0.7496443, 0.25035569999999996, 0.25035569999999996, 0.7496443]], [[0.5000909, 0.4999091, 0.5000565, 0.4999435, 0.4999435, 0.5000565], [0.499963, 0.5000370000000001, 0.4999331, 0.5000669, 0.5000669, 0.4999331], [0.4997138, 0.5002862, 0.5003885, 0.4996115, 0.4996115, 0.5003885], [0.499823, 0.500177, 0.5000834, 0.49991660000000004, 0.49991660000000004, 0.5000834], [0.5000401, 0.4999599, 0.4999311, 0.5000689, 0.5000689, 0.4999311], [0.5001328, 0.49986719999999996, 0.4997023, 0.5002977, 0.5002977, 0.4997023], [0.5001596, 0.49984039999999996, 0.4995406, 0.5004594, 0.5004594, 0.4995406], [0.5001951, 0.4998049, 0.4991715, 0.5008285, 0.5008285, 0.4991715], [0.500067, 0.49993299999999996, 0.4986579, 0.5013421, 0.5013421, 0.4986579], [0.5000857, 0.49991430000000003, 0.4971187, 0.5028813, 0.5028813, 0.4971187], [0.5004327, 0.49956730000000005, 0.4945035, 0.5054965, 0.5054965, 0.4945035], [0.5000487, 0.4999513, 0.4894158, 0.5105842, 0.5105842, 0.4894158], [0.5000396, 0.49996039999999997, 0.4789334, 0.5210665999999999, 0.5210665999999999, 0.4789334], [0.5001218, 0.49987820000000005, 0.4594182, 0.5405818, 0.5405818, 0.4594182], [0.4996843, 0.5003157, 0.4233898, 0.5766102, 0.5766102, 0.4233898], [0.5002951, 0.4997049, 0.2502685, 0.7497315, 0.7497315, 0.2502685]]]

tamper_critical_path = \
[(1, 14, 'A', 'C', 'B', 0.08793588819813358), (1, 15, 'A', 'B', 'C', 0), (2, 14, 'A', 'C', 'B', 0.14522002589772504), (2, 15, 'A', 'C', 'B', 0.06400288218241534), (3, 14, 'A', 'C', 'B', 0.17002858891487882), (3, 15, 'A', 'C', 'B', 0.11608324815255466), (4, 14, 'A', 'C', 'B', 0.18457036981144698), (4, 15, 'A', 'C', 'B', 0.14765893785803158), (5, 14, 'A', 'C', 'B', 0.19182239660621947), (5, 15, 'A', 'C', 'B', 0.16337776734791393), (6, 14, 'A', 'C', 'B', 0.19547356154162154), (6, 15, 'A', 'C', 'B', 0.17443249200648703), (7, 14, 'A', 'C', 'B', 0.19787553342220232), (7, 15, 'A', 'C', 'B', 0.17693845309285033), (8, 14, 'A', 'C', 'B', 0.20082664721614418), (8, 15, 'A', 'C', 'B', 0.18226466804396757), (9, 14, 'A', 'C', 'B', 0.20322442717372197), (9, 15, 'A', 'C', 'B', 0.18469938943389586), (10, 14, 'A', 'C', 'B', 0.20322442717372197), (10, 15, 'A', 'C', 'B', 0.18702934656436082), (11, 14, 'A', 'C', 'B', 0.20322442717372197), (11, 15, 'A', 'C', 'B', 0.18702934656436082), (12, 14, 'A', 'C', 'B', 0.20322442717372197), (12, 15, 'A', 'C', 'B', 0.18910367890173524), (13, 14, 'A', 'C', 'B', 0.20322442717372197), (13, 15, 'A', 'C', 'B', 0.18910367890173524), (0, 0, 'A', 'C', 'B', 0.23985790170417415), (0, 1, 'A', 'C', 'B', 0.28976406320693054), (0, 2, 'A', 'C', 'B', 0.26259279119258666), (0, 3, 'A', 'C', 'B', 0.25481341220235604), (0, 4, 'A', 'C', 'B', 0.2315129781993061), (0, 5, 'A', 'C', 'B', 0.22822863079578365), (0, 6, 'A', 'C', 'B', 0.22620104898034382), (0, 7, 'A', 'C', 'B', 0.22416927794627756), (0, 8, 'A', 'C', 'B', 0.22416927794627756), (0, 9, 'A', 'C', 'B', 0.22416927794627756), (0, 10, 'A', 'C', 'B', 0.22416927794627756), (0, 11, 'A', 'C', 'B', 0.2201057358781438), (0, 12, 'A', 'C', 'B', 0.2201057358781438), (0, 13, 'A', 'C', 'B', 0.22416927794627756), (0, 14, 'A', 'C', 'B', 0.22416927794627756), (0, 15, 'B', 'A', 'C', 0.10020910946188893), (14, 14, 'A', 'C', 'B', 0.12815127811732346), (14, 15, 'B', 'A', 'C', 0.10020910946188893)]
tamper_critical_path_alpha = \
[[[0.999999, 1.0000000000287557e-06, 0.7499911, 0.2500089, 0.2500089, 0.7499911], [0.9374176, 0.06258240000000004, 0.8126507, 0.18734930000000005, 0.18734930000000005, 0.8126507], [0.9062604, 0.09373960000000003, 0.7812961, 0.21870389999999995, 0.21870389999999995, 0.7812961], [0.8907191, 0.10928090000000001, 0.7970361, 0.20296389999999997, 0.20296389999999997, 0.7970361], [0.8828205, 0.11717949999999999, 0.7891215, 0.21087849999999997, 0.21087849999999997, 0.7891215], [0.8787445, 0.12125549999999996, 0.7929254, 0.2070746, 0.2070746, 0.7929254], [0.8768259, 0.12317409999999995, 0.7911092, 0.20889080000000004, 0.20889080000000004, 0.7911092], [0.875971, 0.12402899999999994, 0.7918768, 0.20812319999999995, 0.20812319999999995, 0.7918768], [0.8753898, 0.1246102, 0.7916307, 0.20836929999999998, 0.20836929999999998, 0.7916307], [0.8750715, 0.1249285, 0.791731, 0.20826900000000004, 0.20826900000000004, 0.791731], [0.8750676, 0.12493240000000005, 0.7917568, 0.20824319999999996, 0.20824319999999996, 0.7917568], [0.8749623, 0.12503770000000003, 0.7915017, 0.20849830000000003, 0.20849830000000003, 0.7915017], [0.8749029, 0.12509709999999996, 0.7917889, 0.20821109999999998, 0.20821109999999998, 0.7917889], [0.8750024, 0.12499760000000004, 0.7917628, 0.2082372, 0.2082372, 0.7917628], [0.8750012, 0.12499879999999997, 0.7918994, 0.20810059999999997, 0.20810059999999997, 0.7918994], [0.2502148, 0.7497852, 0.7497842, 0.2502158, 0.2502158, 0.7497842]], [[0.6250904, 0.37490959999999995, 0.5624192, 0.4375808, 0.4375808, 0.5624192], [0.6251775, 0.37482249999999995, 0.5625909, 0.4374091, 0.4374091, 0.5625909], [0.6249393, 0.3750607, 0.5624416, 0.4375584, 0.4375584, 0.5624416], [0.6251423, 0.37485769999999996, 0.5624804, 0.4375196, 0.4375196, 0.5624804], [0.6252772, 0.3747228, 0.5626937, 0.43730630000000004, 0.43730630000000004, 0.5626937], [0.6249542, 0.3750458, 0.562194, 0.43780600000000003, 0.43780600000000003, 0.562194], [0.6250647, 0.37493529999999997, 0.5626711, 0.4373289, 0.4373289, 0.5626711], [0.6250748, 0.37492519999999996, 0.5625903, 0.4374097, 0.4374097, 0.5625903], [0.6249688, 0.3750312, 0.5624081, 0.43759190000000003, 0.43759190000000003, 0.5624081], [0.6251887, 0.37481129999999996, 0.562627, 0.437373, 0.437373, 0.562627], [0.6250245, 0.3749755, 0.5623757, 0.43762429999999997, 0.43762429999999997, 0.5623757], [0.62507, 0.37493, 0.5627247, 0.43727530000000003, 0.43727530000000003, 0.5627247], [0.6251863, 0.3748137, 0.5627657, 0.43723429999999996, 0.43723429999999996, 0.5627657], [0.3751086, 0.6248914, 0.4375619, 0.5624381, 0.5624381, 0.4375619], [0.7498505, 0.2501495, 0.7446435, 0.2553565, 0.2553565, 0.7446435], [0.145924, 0.8540760000000001, 0.749669, 0.25033099999999997, 0.25033099999999997, 0.749669]], [[0.5626926, 0.4373074, 0.5314414, 0.46855860000000005, 0.46855860000000005, 0.5314414], [0.5624215, 0.4375785, 0.5310797, 0.46892029999999996, 0.46892029999999996, 0.5310797], [0.5625368, 0.43746320000000005, 0.531246, 0.468754, 0.468754, 0.531246], [0.5625419, 0.43745809999999996, 0.5312419, 0.46875809999999996, 0.46875809999999996, 0.5312419], [0.5622559, 0.43774409999999997, 0.5313071, 0.46869289999999997, 0.46869289999999997, 0.5313071], [0.5624021, 0.4375979, 0.5311593, 0.4688407, 0.4688407, 0.5311593], [0.5623238, 0.43767619999999996, 0.531456, 0.46854399999999996, 0.46854399999999996, 0.531456], [0.5624251, 0.4375749, 0.5312346, 0.4687654, 0.4687654, 0.5312346], [0.562849, 0.43715099999999996, 0.5313542, 0.4686458, 0.4686458, 0.5313542], [0.562149, 0.437851, 0.5312006, 0.4687994, 0.4687994, 0.5312006], [0.5627676, 0.43723239999999997, 0.53141, 0.46858999999999995, 0.46858999999999995, 0.53141], [0.5627557, 0.43724430000000003, 0.5313124, 0.4686876, 0.4686876, 0.5313124], [0.4374766, 0.5625234, 0.4685508, 0.5314492, 0.5314492, 0.4685508], [0.6078548, 0.39214519999999997, 0.5538632, 0.4461368, 0.4461368, 0.5538632], [0.7764202, 0.2235798, 0.747326, 0.25267399999999995, 0.25267399999999995, 0.747326], [0.7982187, 0.20178130000000005, 0.2306464, 0.7693536, 0.7693536, 0.2306464]], [[0.5310709, 0.4689291, 0.5155367, 0.48446330000000004, 0.48446330000000004, 0.5155367], [0.5311671, 0.4688329, 0.5155785, 0.48442149999999995, 0.48442149999999995, 0.5155785], [0.5313568, 0.46864320000000004, 0.5157205, 0.4842795, 0.4842795, 0.5157205], [0.5311352, 0.46886479999999997, 0.5154696, 0.4845304, 0.4845304, 0.5154696], [0.5313486, 0.46865140000000005, 0.5156646, 0.48433539999999997, 0.48433539999999997, 0.5156646], [0.5313003, 0.46869970000000005, 0.515714, 0.484286, 0.484286, 0.515714], [0.5313103, 0.4686897, 0.5152953, 0.4847047, 0.4847047, 0.5152953], [0.5315544, 0.4684456, 0.5156139, 0.48438610000000004, 0.48438610000000004, 0.5156139], [0.5312509, 0.46874910000000003, 0.5156136, 0.4843864, 0.4843864, 0.5156136], [0.5315204, 0.4684796, 0.5157575, 0.4842425, 0.4842425, 0.5157575], [0.5313854, 0.4686146, 0.5156387, 0.4843613, 0.4843613, 0.5156387], [0.4687314, 0.5312686, 0.4844982, 0.5155018, 0.5155018, 0.4844982], [0.5550413, 0.44495870000000004, 0.5273524, 0.47264759999999995, 0.47264759999999995, 0.5273524], [0.5751876, 0.4248124, 0.5466949, 0.4533051, 0.4533051, 0.5466949], [0.7754649, 0.2245351, 0.7566193, 0.2433807, 0.2433807, 0.7566193], [0.7854143, 0.2145857, 0.2028213, 0.7971787, 0.7971787, 0.2028213]], [[0.5154828, 0.4845172, 0.5079546, 0.49204539999999997, 0.49204539999999997, 0.5079546], [0.5156811, 0.4843189, 0.5078782, 0.49212180000000005, 0.49212180000000005, 0.5078782], [0.5154293, 0.4845707, 0.5075453, 0.4924547, 0.4924547, 0.5075453], [0.5156551, 0.48434489999999997, 0.5075213, 0.49247870000000005, 0.49247870000000005, 0.5075213], [0.5155773, 0.4844227, 0.5076264, 0.49237359999999997, 0.49237359999999997, 0.5076264], [0.5157332, 0.4842668, 0.508169, 0.491831, 0.491831, 0.508169], [0.5157062, 0.4842938, 0.5076789, 0.49232109999999996, 0.49232109999999996, 0.5076789], [0.5157463, 0.4842537, 0.5078789, 0.4921211, 0.4921211, 0.5078789], [0.5157717, 0.48422829999999994, 0.5078518, 0.49214820000000004, 0.49214820000000004, 0.5078518], [0.5155979, 0.48440209999999995, 0.5077143, 0.49228570000000005, 0.49228570000000005, 0.5077143], [0.4844724, 0.5155276, 0.4925228, 0.5074772000000001, 0.5074772000000001, 0.4925228], [0.5279031, 0.47209690000000004, 0.5138016, 0.48619840000000003, 0.48619840000000003, 0.5138016], [0.538273, 0.461727, 0.5231614, 0.4768386, 0.4768386, 0.5231614], [0.5483028, 0.4516972, 0.5432622, 0.45673779999999997, 0.45673779999999997, 0.5432622], [0.7683221, 0.2316779, 0.7653468, 0.2346532, 0.2346532, 0.7653468], [0.7731586, 0.22684139999999997, 0.1834499, 0.8165501, 0.8165501, 0.1834499]], [[0.5079601, 0.4920399, 0.5040832, 0.49591680000000005, 0.49591680000000005, 0.5040832], [0.5075815, 0.4924185, 0.5037915, 0.49620850000000005, 0.49620850000000005, 0.5037915], [0.5075501, 0.4924499, 0.5034966, 0.49650340000000004, 0.49650340000000004, 0.5034966], [0.5077172, 0.4922828, 0.5038287, 0.4961713, 0.4961713, 0.5038287], [0.5079237, 0.4920763, 0.5038656, 0.4961344, 0.4961344, 0.5038656], [0.5077943, 0.49220569999999997, 0.5041647, 0.4958353, 0.4958353, 0.5041647], [0.5077947, 0.49220529999999996, 0.5034933, 0.49650669999999997, 0.49650669999999997, 0.5034933], [0.5077812, 0.49221879999999996, 0.5037746, 0.49622540000000004, 0.49622540000000004, 0.5037746], [0.5076561, 0.49234389999999995, 0.5039163, 0.4960837, 0.4960837, 0.5039163], [0.4921569, 0.5078431, 0.4961987, 0.5038013, 0.5038013, 0.4961987], [0.5139303, 0.48606970000000005, 0.5071014, 0.49289859999999996, 0.49289859999999996, 0.5071014], [0.5191083, 0.48089170000000003, 0.5115691, 0.4884309, 0.4884309, 0.5115691], [0.5247415, 0.47525850000000003, 0.5219248, 0.47807520000000003, 0.47807520000000003, 0.5219248], [0.5292363, 0.4707637, 0.5417191, 0.4582809, 0.4582809, 0.5417191], [0.7620456, 0.2379544, 0.7721843, 0.22781569999999995, 0.22781569999999995, 0.7721843], [0.7643472, 0.2356528, 0.1710569, 0.8289431, 0.8289431, 0.1710569]], [[0.50379, 0.49621000000000004, 0.5020438, 0.49795619999999996, 0.49795619999999996, 0.5020438], [0.503747, 0.49625300000000006, 0.5019088, 0.49809119999999996, 0.49809119999999996, 0.5019088], [0.5036463, 0.4963537, 0.501813, 0.49818700000000005, 0.49818700000000005, 0.501813], [0.5038377, 0.49616229999999995, 0.5021685, 0.4978315, 0.4978315, 0.5021685], [0.504045, 0.49595500000000003, 0.5020484, 0.49795160000000005, 0.49795160000000005, 0.5020484], [0.5037659, 0.4962341, 0.5019073, 0.49809270000000005, 0.49809270000000005, 0.5019073], [0.5038294, 0.4961706, 0.5016847, 0.4983153, 0.4983153, 0.5016847], [0.503922, 0.496078, 0.5019496, 0.4980504, 0.4980504, 0.5019496], [0.4960917, 0.5039083, 0.4981243, 0.5018757, 0.5018757, 0.4981243], [0.5071385, 0.49286149999999995, 0.5037615, 0.4962385, 0.4962385, 0.5037615], [0.509761, 0.490239, 0.5060509, 0.49394910000000003, 0.49394910000000003, 0.5060509], [0.5122483, 0.4877517, 0.5108244, 0.48917560000000004, 0.48917560000000004, 0.5108244], [0.5147499, 0.4852501, 0.5213109, 0.4786891, 0.4786891, 0.5213109], [0.5171835, 0.4828165, 0.5410042, 0.45899579999999995, 0.45899579999999995, 0.5410042], [0.7573293, 0.24267070000000002, 0.7769195, 0.22308050000000001, 0.22308050000000001, 0.7769195], [0.7584039, 0.24159609999999998, 0.1635992, 0.8364008, 0.8364008, 0.1635992]], [[0.5019903, 0.4980097, 0.5010986, 0.49890140000000005, 0.49890140000000005, 0.5010986], [0.5016914, 0.4983086, 0.5008904, 0.49910960000000004, 0.49910960000000004, 0.5008904], [0.5019885, 0.49801150000000005, 0.5009892, 0.4990108, 0.4990108, 0.5009892], [0.5020911, 0.4979089, 0.5012308, 0.4987692, 0.4987692, 0.5012308], [0.5018496, 0.4981504, 0.5009104, 0.4990896, 0.4990896, 0.5009104], [0.5016924, 0.49830759999999996, 0.5008925, 0.49910750000000004, 0.49910750000000004, 0.5008925], [0.5018563, 0.49814369999999997, 0.5009445, 0.4990555, 0.4990555, 0.5009445], [0.4979823, 0.5020177, 0.4991246, 0.5008754, 0.5008754, 0.4991246], [0.5037303, 0.49626970000000004, 0.5020207, 0.4979793, 0.4979793, 0.5020207], [0.5050502, 0.4949498, 0.5029653, 0.49703470000000005, 0.49703470000000005, 0.5029653], [0.5059733, 0.49402670000000004, 0.5054516, 0.4945484, 0.4945484, 0.5054516], [0.5075322, 0.4924678, 0.511099, 0.48890100000000003, 0.48890100000000003, 0.511099], [0.5086224, 0.49137759999999997, 0.5211753, 0.4788247, 0.4788247, 0.5211753], [0.5101769, 0.48982309999999996, 0.5408605, 0.45913950000000003, 0.45913950000000003, 0.5408605], [0.7542451, 0.2457549, 0.779924, 0.22007600000000005, 0.22007600000000005, 0.779924], [0.7546448, 0.2453552, 0.1593637, 0.8406363, 0.8406363, 0.1593637]], [[0.5008361, 0.4991639, 0.500456, 0.499544, 0.499544, 0.500456], [0.500923, 0.499077, 0.5004403, 0.49955970000000005, 0.49955970000000005, 0.5004403], [0.5011603, 0.4988397, 0.5006855, 0.4993145, 0.4993145, 0.5006855], [0.5009519, 0.4990481, 0.5005705, 0.49942949999999997, 0.49942949999999997, 0.5005705], [0.5009006, 0.49909939999999997, 0.5003561, 0.49964390000000003, 0.49964390000000003, 0.5003561], [0.5010915, 0.4989085, 0.5007871, 0.49921289999999996, 0.49921289999999996, 0.5007871], [0.4991115, 0.5008885000000001, 0.4994269, 0.5005731, 0.5005731, 0.4994269], [0.5018669, 0.4981331, 0.5009077, 0.49909230000000004, 0.49909230000000004, 0.5009077], [0.5023958, 0.49760420000000005, 0.5012991, 0.4987009, 0.4987009, 0.5012991], [0.5030636, 0.49693639999999994, 0.5027099, 0.49729009999999996, 0.49729009999999996, 0.5027099], [0.5040143, 0.4959857, 0.5056629, 0.4943371, 0.4943371, 0.5056629], [0.5046238, 0.49537620000000004, 0.5107563, 0.48924369999999995, 0.48924369999999995, 0.5107563], [0.5051552, 0.4948448, 0.5210878, 0.4789122, 0.4789122, 0.5210878], [0.505661, 0.494339, 0.5409693, 0.4590307, 0.4590307, 0.5409693], [0.7523581, 0.24764189999999997, 0.7815746, 0.2184254, 0.2184254, 0.7815746], [0.7528027, 0.24719729999999995, 0.1566027, 0.8433973, 0.8433973, 0.1566027]], [[0.5005196, 0.49948040000000005, 0.5003078, 0.49969220000000003, 0.49969220000000003, 0.5003078], [0.5006958, 0.4993042, 0.5003419, 0.4996581, 0.4996581, 0.5003419], [0.5003985, 0.49960150000000003, 0.5003773, 0.4996227, 0.4996227, 0.5003773], [0.5002712, 0.4997288, 0.5000338, 0.4999662, 0.4999662, 0.5000338], [0.5006494, 0.4993506, 0.5004575, 0.4995425, 0.4995425, 0.5004575], [0.4995777, 0.5004223, 0.4998913, 0.5001087, 0.5001087, 0.4998913], [0.5008225, 0.49917750000000005, 0.5004862, 0.4995138, 0.4995138, 0.5004862], [0.5012095, 0.4987905, 0.5007258, 0.4992742, 0.4992742, 0.5007258], [0.5014352, 0.49856480000000003, 0.5013423, 0.4986577, 0.4986577, 0.5013423], [0.5019179, 0.49808209999999997, 0.5026336, 0.4973664, 0.4973664, 0.5026336], [0.5022234, 0.4977766, 0.5054613, 0.4945387, 0.4945387, 0.5054613], [0.5026474, 0.49735260000000003, 0.5107105, 0.48928950000000004, 0.48928950000000004, 0.5107105], [0.5030588, 0.49694119999999997, 0.5213178, 0.47868219999999995, 0.47868219999999995, 0.5213178], [0.5025932, 0.49740680000000004, 0.5406278, 0.4593722, 0.4593722, 0.5406278], [0.7513674, 0.24863259999999998, 0.7831457, 0.21685430000000006, 0.21685430000000006, 0.7831457], [0.7514332, 0.24856679999999998, 0.155216, 0.844784, 0.844784, 0.155216]], [[0.5002854, 0.4997146, 0.5002205, 0.49977950000000004, 0.49977950000000004, 0.5002205], [0.5003971, 0.49960289999999996, 0.5003548, 0.4996452, 0.4996452, 0.5003548], [0.499925, 0.500075, 0.499991, 0.5000089999999999, 0.5000089999999999, 0.499991], [0.5003344, 0.49966560000000004, 0.5002134, 0.49978659999999997, 0.49978659999999997, 0.5002134], [0.4996372, 0.5003628, 0.4996834, 0.5003166, 0.5003166, 0.4996834], [0.5003734, 0.49962660000000003, 0.5002911, 0.4997089, 0.4997089, 0.5002911], [0.5006588, 0.49934120000000004, 0.5002794, 0.49972059999999996, 0.49972059999999996, 0.5002794], [0.5006601, 0.49933989999999995, 0.5007011, 0.4992989, 0.4992989, 0.5007011], [0.5007055, 0.4992945, 0.5013842, 0.49861580000000005, 0.49861580000000005, 0.5013842], [0.5012079, 0.49879209999999996, 0.5026977, 0.4973023, 0.4973023, 0.5026977], [0.5012316, 0.4987684, 0.5051992, 0.49480080000000004, 0.49480080000000004, 0.5051992], [0.501522, 0.498478, 0.510792, 0.489208, 0.489208, 0.510792], [0.5013215, 0.4986785, 0.5210239, 0.4789761, 0.4789761, 0.5210239], [0.501705, 0.49829500000000004, 0.5407571, 0.4592429, 0.4592429, 0.5407571], [0.7510049, 0.24899510000000002, 0.7836135, 0.21638650000000004, 0.21638650000000004, 0.7836135], [0.7508691, 0.24913090000000004, 0.1542148, 0.8457852, 0.8457852, 0.1542148]], [[0.500291, 0.49970899999999996, 0.4999654, 0.5000346, 0.5000346, 0.4999654], [0.5000035, 0.49999649999999995, 0.4999742, 0.5000258, 0.5000258, 0.4999742], [0.5001392, 0.4998608, 0.4999717, 0.5000283, 0.5000283, 0.4999717], [0.4996368, 0.5003632, 0.4999295, 0.5000705, 0.5000705, 0.4999295], [0.5001832, 0.49981679999999995, 0.5000996, 0.4999004, 0.4999004, 0.5000996], [0.5002105, 0.4997895, 0.5000152, 0.4999848, 0.4999848, 0.5000152], [0.5004139, 0.49958610000000003, 0.500415, 0.49958499999999995, 0.49958499999999995, 0.500415], [0.500369, 0.49963100000000005, 0.5005387, 0.4994613, 0.4994613, 0.5005387], [0.5003576, 0.49964240000000004, 0.5012989, 0.4987011, 0.4987011, 0.5012989], [0.5006806, 0.49931939999999997, 0.5027098, 0.4972902, 0.4972902, 0.5027098], [0.5005568, 0.4994432, 0.5053688, 0.49463120000000005, 0.49463120000000005, 0.5053688], [0.5005371, 0.49946290000000004, 0.5106144, 0.4893856, 0.4893856, 0.5106144], [0.5006937, 0.4993063, 0.5212598, 0.47874019999999995, 0.47874019999999995, 0.5212598], [0.5008344, 0.4991656, 0.540968, 0.459032, 0.459032, 0.540968], [0.7501498, 0.24985020000000002, 0.7836704, 0.2163296, 0.2163296, 0.7836704], [0.7502343, 0.24976569999999998, 0.1539111, 0.8460889, 0.8460889, 0.1539111]], [[0.4999651, 0.5000349, 0.4998159, 0.5001841, 0.5001841, 0.4998159], [0.4999866, 0.5000134, 0.5000445, 0.4999555, 0.4999555, 0.5000445], [0.4997389, 0.5002611, 0.4998293, 0.5001707, 0.5001707, 0.4998293], [0.5000235, 0.49997650000000005, 0.5001046, 0.4998954, 0.4998954, 0.5001046], [0.5001469, 0.49985310000000005, 0.5000008, 0.4999992, 0.4999992, 0.5000008], [0.5002303, 0.4997697, 0.5001285, 0.4998715, 0.4998715, 0.5001285], [0.5001769, 0.49982309999999996, 0.5003841, 0.4996159, 0.4996159, 0.5003841], [0.5003107, 0.4996893, 0.5008703, 0.4991297, 0.4991297, 0.5008703], [0.5004722, 0.49952779999999997, 0.5014886, 0.49851140000000005, 0.49851140000000005, 0.5014886], [0.5004784, 0.4995216, 0.5030793, 0.4969207, 0.4969207, 0.5030793], [0.5000168, 0.49998319999999996, 0.5053522, 0.49464779999999997, 0.49464779999999997, 0.5053522], [0.5006006, 0.49939940000000005, 0.5107655, 0.4892345, 0.4892345, 0.5107655], [0.500588, 0.49941199999999997, 0.5211319, 0.4788681, 0.4788681, 0.5211319], [0.5002473, 0.49975270000000005, 0.5406079, 0.45939209999999997, 0.45939209999999997, 0.5406079], [0.7502948, 0.24970519999999996, 0.7840837, 0.21591629999999995, 0.21591629999999995, 0.7840837], [0.7502757, 0.2497243, 0.1535117, 0.8464883, 0.8464883, 0.1535117]], [[0.500028, 0.49997199999999997, 0.5000555, 0.4999445, 0.4999445, 0.5000555], [0.4998803, 0.5001197, 0.5000735, 0.49992650000000005, 0.49992650000000005, 0.5000735], [0.5001109, 0.4998891, 0.5000128, 0.49998719999999996, 0.49998719999999996, 0.5000128], [0.4999543, 0.5000457, 0.4998274, 0.5001726, 0.5001726, 0.4998274], [0.4999578, 0.5000422, 0.4998899, 0.5001101, 0.5001101, 0.4998899], [0.5000114, 0.4999886, 0.5002827, 0.49971730000000003, 0.49971730000000003, 0.5002827], [0.5000915, 0.4999085, 0.5002613, 0.4997387, 0.4997387, 0.5002613], [0.500149, 0.49985100000000005, 0.5006341, 0.49936590000000003, 0.49936590000000003, 0.5006341], [0.5001584, 0.4998416, 0.501707, 0.498293, 0.498293, 0.501707], [0.5000953, 0.4999047, 0.5027699, 0.4972301, 0.4972301, 0.5027699], [0.500054, 0.499946, 0.5052329, 0.4947671, 0.4947671, 0.5052329], [0.5005759, 0.49942410000000004, 0.5109994, 0.4890006, 0.4890006, 0.5109994], [0.5000936, 0.4999064, 0.5206535, 0.4793465, 0.4793465, 0.5206535], [0.500201, 0.499799, 0.5409521, 0.45904789999999995, 0.45904789999999995, 0.5409521], [0.7502563, 0.2497437, 0.7842778, 0.21572219999999998, 0.21572219999999998, 0.7842778], [0.750021, 0.24997899999999995, 0.1534066, 0.8465933999999999, 0.8465933999999999, 0.1534066]], [[0.5000909, 0.4999091, 0.5000565, 0.4999435, 0.4999435, 0.5000565], [0.499963, 0.5000370000000001, 0.4999331, 0.5000669, 0.5000669, 0.4999331], [0.4997138, 0.5002862, 0.5003885, 0.4996115, 0.4996115, 0.5003885], [0.499823, 0.500177, 0.5000834, 0.49991660000000004, 0.49991660000000004, 0.5000834], [0.5000401, 0.4999599, 0.4999311, 0.5000689, 0.5000689, 0.4999311], [0.5001328, 0.49986719999999996, 0.4997023, 0.5002977, 0.5002977, 0.4997023], [0.5001596, 0.49984039999999996, 0.4995406, 0.5004594, 0.5004594, 0.4995406], [0.5001951, 0.4998049, 0.4991715, 0.5008285, 0.5008285, 0.4991715], [0.500067, 0.49993299999999996, 0.4986579, 0.5013421, 0.5013421, 0.4986579], [0.5000857, 0.49991430000000003, 0.4971187, 0.5028813, 0.5028813, 0.4971187], [0.5004327, 0.49956730000000005, 0.4945035, 0.5054965, 0.5054965, 0.4945035], [0.5000487, 0.4999513, 0.4894158, 0.5105842, 0.5105842, 0.4894158], [0.5000396, 0.49996039999999997, 0.4789334, 0.5210665999999999, 0.5210665999999999, 0.4789334], [0.5001218, 0.49987820000000005, 0.4594182, 0.5405818, 0.5405818, 0.4594182], [0.2500048, 0.7499952, 0.6535823, 0.34641770000000005, 0.34641770000000005, 0.6535823], [0.7497954, 0.2502046, 0.2502685, 0.7497315, 0.7497315, 0.2502685]]]


########################################################################################
################## Functions
########################################################################################

def get_alpha(raw_mp, bit_len, log=False, rew_lst=[], verify=False):
    return AlphaSampled(raw_mp, bit_len, rew_lst).run_multi(ALPHA_SAMPLE_COUNT, RND_SEED, log=log, proc_count=PROCESS_COUNT)

def get_FA_delay(fa_alpha, temp, sec):
    tg1_alpha = max(fa_alpha[0], fa_alpha[1])
    tg1_vth = abs(BTI.Vth) + BTI.delta_vth(BTI.Vdef, temp, tg1_alpha, BTI.Tclk, sec)
    tg1_pb = pmos_vth_to_body(tg1_vth)

    tg2_alpha = max(fa_alpha[2], fa_alpha[3])
    tg2_vth = abs(BTI.Vth) + BTI.delta_vth(BTI.Vdef, temp, tg2_alpha, BTI.Tclk, sec)
    tg2_pb = pmos_vth_to_body(tg2_vth)

    return tgate_pb_to_delay(tg1_pb) + tgate_pb_to_delay(tg2_pb)

def get_MP_delay(critical_fa_lst, alpha, temp, sec):
    ps = 0
    for fa_lay, fa_i in critical_fa_lst:
        ps += get_FA_delay(alpha[fa_lay][fa_i], temp, sec)
    return ps


def get_best_worst_wire_comb(
        log = False,
        bitlen = BIT_LEN,
        temp = TEMP,
        mp = MPn_rew,
        critical_fa_lst = CRITICAL_FA_lst,
):
    # default wiring in multiplier
    best_wiring = [fa + ('A', 'B', 'C', 0) for fa in critical_fa_lst]
    worst_wiring = [fa + ('A', 'B', 'C', 0) for fa in critical_fa_lst]

    default_alpha = get_alpha(mp, bitlen, log=log, rew_lst=[])
    if log:
        log.println(f"\n{default_alpha}")
        log.println(f"default alpha done")


    # iterate in Critical FA list, and log the worst wiring for each
    for fa_index, fa in enumerate(critical_fa_lst):
        wire_combination = [
            ('A', 'B', 'C'),
            ('A', 'C', 'B'),
            ('B', 'A', 'C'),
            ('B', 'C', 'A'),
            ('C', 'A', 'B'),
            ('C', 'B', 'A'),
        ]
        lay, i = fa
        FA_zero_delay = get_FA_delay(default_alpha[lay][i], temp, 0)

        aging_period = 12*30 *24*60*60
        fa_default_delay = get_FA_delay(default_alpha[lay][i], temp, aging_period)
        fa_default_aging_rate = (fa_default_delay - FA_zero_delay) / FA_zero_delay
        if log:
            log.println(f"default wiring, delay rate: {fa_default_aging_rate * 100 :.2f}% [t:{aging_period}s]")
        
        _worst_rate = fa_default_aging_rate
        _best_rate = fa_default_aging_rate
        for comb in wire_combination[1:]:
            rewire = fa + comb
            rewire_alpha = get_alpha(mp, bitlen, log=log, rew_lst=[rewire])

            fa_delay = get_FA_delay(rewire_alpha[lay][i], temp, aging_period)
            fa_aging_rate = (fa_delay - FA_zero_delay) / FA_zero_delay
            if log:
                log.println(f"{rewire}, delay rate: {fa_aging_rate * 100 :.2f}% [t:{aging_period}s]")

            if fa_aging_rate > _worst_rate:
                _worst_rate = fa_aging_rate
                worst_wiring[fa_index] = fa + comb + (fa_aging_rate - fa_default_aging_rate, )
                if log:
                    log.println(f"-new worst")
            if fa_aging_rate < _best_rate:
                _best_rate = fa_aging_rate
                best_wiring[fa_index] = fa + comb + (fa_aging_rate - fa_default_aging_rate, )
                if log:
                    log.println(f"-new best")
            
        if log:
            log.println()
    
    if log:
        log.println(f"best wiring combination: \n{best_wiring}")
        log.println(f"worst wiring combination: \n{worst_wiring}")

    return (best_wiring, worst_wiring)


"""
wire combination notation:

(0, 0, 'C', 'B', 'A', 0.50)
- FA index
- FA wiring combination
- difference of aging_rate and default_aging_rate
"""
def examine_wire_comb(
        wire_comb,
        bit_len = BIT_LEN, 
        temp = TEMP, 
        log = log, 
        plot = "RATE" or "DELAY", 
        plot_save_clear = True,
        plot_label = "",
        alpha_verification = ALPHA_VERIFICATION, 
        critical_fa_lst = CRITICAL_FA_lst, 
        mp = MPn_rew,
    ): 
    if log:   
        log.println(f"aging log for following wire comb \n{wire_comb}")
    
    alpha = get_alpha(mp, bit_len, log=False, rew_lst=wire_comb, verify=alpha_verification)
    if log:
        log.println(f"alpha: \n{alpha}")
    _mp_zero_delay = get_MP_delay(critical_fa_lst, alpha, temp, 0)
    
    res_week = []
    res_delay = []

    for week in range(0, 200):
        delay = get_MP_delay(critical_fa_lst, alpha, temp, week * 7 *24*60*60)
        aging_rate = (delay - _mp_zero_delay) / _mp_zero_delay
        if log:
            log.println(f"week {week:03}: {delay: 8.2f} [{aging_rate * 100 :4.2f}%]")
        
        if plot:
            res_week.append(week)

            if plot == "DELAY":
                res_delay.append(delay)
            elif plot == "RATE" or True:
                res_delay.append(aging_rate)

    
    if plot:
        plt.plot(res_week, res_delay, label=plot_label)
        plt.title(f"ArrayMultiplier-BIT-{bit_len}-TEMP-{temp}")

        if plot_save_clear:
            timestamp = datetime.now().strftime('%m,%d-%H:%M:%S.%f')
            fig_name = f"fig-{timestamp}.jpg"
            plt.legend()
            plt.savefig(fig_name)
            plt.clf()
            if log:
                log.println(f"plot saved in {fig_name}")



def examine_multi_wire_comb(
        multi_wire_comb,
        plot_labels,
        log = log, 
        plot = True,
    ): 

    for i_sub_wc, sub_wc in enumerate(multi_wire_comb):
        examine_wire_comb(
            sub_wc,
            log = log, 
            plot = plot, 
            plot_save_clear = True if i_sub_wc==len(multi_wire_comb)-1 else False,
            plot_label = plot_labels[i_sub_wc],
        )


def sort_rewiring(wiring):
    return sorted(wiring, key=lambda x: x[-1], reverse=True)


########################################################################################
################## MAIN
########################################################################################


"""get critical path priorities"""
if False and (__name__ == "__main__"):
    """each path gets full rewiring -> aging(1 year) -> route with higher aging higher priority"""
    log.println("RUNNING: critical path priorities")
    for i in range(BIT_LEN - 1):
        critical_path = create_crit(i)
        _, worst_wiring = get_best_worst_wire_comb(
            log=False,
            bitlen=BIT_LEN,
            critical_fa_lst=critical_path,
            mp=MPn_rew,
        )

        alpha_nomitigation = get_alpha(MPn_rew, BIT_LEN, log=False, rew_lst=[])
        alpha_rewired = get_alpha(MPn_rew, BIT_LEN, log=False, rew_lst=worst_wiring)
        delay_nomitigation = get_MP_delay(critical_path, alpha_nomitigation, TEMP, 50 * 7 *24*60*60)
        delay_rewired = get_MP_delay(critical_path, alpha_rewired, TEMP, 50 * 7 *24*60*60)

        log.println(f"path [{i}] -> delay(1 year): {delay_nomitigation:.4f} -> {delay_rewired:.4f}")
        log.println(f"{sort_rewiring(worst_wiring)}")
    


"""specific wire combination aging"""
if False and (__name__ == "__main__"):
    # normal aging without mitigation

    REW_LST = tamper_critical_path

    # rewire top-20% of circuit
    # circuit_size = (BIT_LEN - 1) * (BIT_LEN)
    # REW_LST = REW_LST[:(circuit_size//5)]
    
    examine_wire_comb(
        wire_comb = REW_LST,
        bit_len=BIT_LEN, 
        temp=TEMP, 
        log=log, 
        plot=True, 
        alpha_verification=ALPHA_VERIFICATION,
        critical_fa_lst=CRITICAL_FA_lst
        )
    

"""
extracting best and worst wiring combination for the provided multiplier (6, 8, 10 bits)
"""
if False and (__name__ == "__main__"):
    best_wiring, worst_wiring = get_best_worst_wire_comb(log=log)
    log.println(f"worst wiring:\n{worst_wiring}")
    
    examine_multi_wire_comb(
        [worst_wiring, [], best_wiring],
        ["attack", "no-mitigation", "optimization"],
        log=log,
        plot="DELAY",
    )


"""
partial rewiring
"""
if False and (__name__ == "__main__"):
    _, worst_wiring = get_best_worst_wire_comb(log=False)
    worst_wiring = sorted(worst_wiring, key=lambda x: x[-1], reverse=True)

    full_combo = []
    full_combo_label = []
    # for combo in range(0, len(worst_wiring)+1, 4):
    for combo in [0, len(worst_wiring)//4, len(worst_wiring)//2, len(worst_wiring)*3//4, len(worst_wiring)]:
        full_combo.append(worst_wiring[0:combo])
        full_combo_label.append(f"{combo} / {len(worst_wiring)}")
    log.println(f"wire combo:\n{full_combo}")
    
    examine_multi_wire_comb(
        multi_wire_comb = full_combo,
        plot_labels = full_combo_label,
        log = log,
        plot = "DELAY"
    )



"""
rewiring list for all the FAs (sorted)
"""
if True and (__name__ == "__main__"):
    lst = []
    for fa_i in range(BIT_LEN - 1):
        for fa_j in range(BIT_LEN):
            lst += [(fa_i, fa_j)]

    best_wiring, worst_wiring = get_best_worst_wire_comb(critical_fa_lst=lst, log=False)
    log.println(f"worst complete wiring:\n{worst_wiring}")
    worst_wiring = sort_rewiring(worst_wiring)
    log.println(f"worst complete wiring (sorted):\n{worst_wiring}")


"""
error rate of wire combination
"""
if False and __name__ == "__main__":
    # REW_LST = []

    log.println(f"RUNNING: error rate bitlen [{BIT_LEN}], REW_LST [{len(REW_LST)}]: \n{REW_LST}")

    alpha_notamper = get_alpha(MPn_rew, BIT_LEN, log=False, rew_lst=[], verify=False)
    alpha = get_alpha(MPn_rew, BIT_LEN, log=False, rew_lst=REW_LST, verify=False)

    res = []
    for t_week in range(200):
    # for t_week in [50, 100, 150, 199]:
        t_sec = t_week *7 *25*60*60
        
        max_ps_delay = get_MP_delay(CRITICAL_FA_lst, alpha_notamper, TEMP, t_sec) * 1.10    #10% margin
        err_rate, max_seen_delay = array_multiplier_error_rate(BIT_LEN, alpha, TEMP, t_sec, max_ps_delay)
        res.append(err_rate)
        
        log.println(f"REW [{len(REW_LST)}] week [{t_week:03}], error rate: {err_rate:.3f}, max seen delay: {max_seen_delay:.3f}, max_allowed_delay: {max_ps_delay:.3f}")
    log.println(f"REW [{len(REW_LST)}], error rate: \n{res}")

